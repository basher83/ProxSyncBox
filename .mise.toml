# Mise configuration for ProxSyncBox
[tools]
python = "3.11"
uv = "latest"
ruff = "latest"
mypy = "latest"
pre-commit = "latest"
node = "20"  # For prettier and markdownlint

[env]
VIRTUAL_ENV = ".venv"
PATH_add = [".venv/bin"]

[tasks.setup]
description = "Set up the development environment"
run = """
uv venv
uv pip install -e ".[dev]"
pre-commit install
echo "âœ… Development environment ready!"
"""

[tasks.install]
description = "Install production dependencies"
run = "uv pip install -e ."

[tasks.install-dev]
description = "Install development dependencies"
run = "uv pip install -e '.[dev]'"

[tasks.lint]
description = "Run all linters"
depends = ["lint:ruff", "lint:mypy", "lint:markdown"]

[tasks."lint:ruff"]
description = "Run ruff linter"
run = "ruff check . --fix"

[tasks."lint:mypy"]
description = "Run mypy type checker"
run = "mypy ."

[tasks."lint:markdown"]
description = "Lint markdown files"
run = "markdownlint-cli2 '**/*.md'"

[tasks.format]
description = "Format all code"
depends = ["format:python", "format:markdown"]

[tasks."format:python"]
description = "Format Python code with ruff"
run = "ruff format ."

[tasks."format:markdown"]
description = "Format markdown files"
run = "prettier --write '**/*.md'"

[tasks.test]
description = "Run tests"
run = "pytest"

[tasks."test:watch"]
description = "Run tests in watch mode"
run = "pytest-watch"

[tasks."test:cov"]
description = "Run tests with coverage"
run = "pytest --cov"

[tasks.run]
description = "Run the ProxSyncBox GUI"
run = "python gui_app.py"

[tasks.clean]
description = "Clean up generated files"
run = """
rm -rf .ruff_cache
rm -rf .mypy_cache
rm -rf .pytest_cache
rm -rf htmlcov
rm -rf dist
rm -rf build
rm -rf *.egg-info
find . -type d -name __pycache__ -exec rm -rf {} +
find . -type f -name "*.pyc" -delete
echo "âœ¨ Cleaned up!"
"""

[tasks.check]
description = "Run all checks (lint, format check, type check, tests)"
run = """
echo "ğŸ” Running ruff check..."
ruff check .
echo "ğŸ“ Checking formatting..."
ruff format --check .
echo "ğŸ” Running type check..."
mypy .
echo "ğŸ§ª Running tests..."
pytest
echo "âœ… All checks passed!"
"""

[tasks."check:pre-commit"]
description = "Run pre-commit hooks on all files"
run = "pre-commit run --all-files"

[tasks.docs]
description = "Serve documentation locally"
run = "python -m http.server --directory docs 8080"

[tasks.upgrade]
description = "Upgrade all dependencies"
run = """
uv pip install --upgrade -e ".[dev]"
pre-commit autoupdate
echo "ğŸ“¦ Dependencies upgraded!"
"""

[tasks.dev]
description = "Start development mode with file watching"
run = """
echo "ğŸ‘€ Starting development mode..."
python gui_app.py
"""

[tasks.fix]
description = "Auto-fix all code issues"
run = """
echo "ğŸ”§ Fixing Python code..."
ruff check . --fix --unsafe-fixes
ruff format .
echo "ğŸ“ Fixing Markdown..."
markdownlint-cli2 --fix '**/*.md'
prettier --write '**/*.md'
echo "âœ¨ All fixed!"
"""

[tasks.ci]
description = "Run CI checks locally"
run = """
echo "ğŸš€ Running CI checks locally..."
mise run check
echo "âœ… Ready for CI!"
"""

[tasks.deps]
description = "Show dependency tree"
run = "uv pip tree"

[tasks.outdated]
description = "Show outdated dependencies"
run = "uv pip list --outdated"

[tasks.security]
description = "Run security checks"
run = """
echo "ğŸ”’ Running security checks..."
bandit -r . --skip B101,B601
echo "âœ… Security check complete!"
"""